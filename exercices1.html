<!-- AUTO-DETECTABLE EXERCISE FILE -->

<!-- 1. METADATA & CONFIG -->
<script type="application/json" id="exercise-data">
{
    "title": "Ejercicios Lección 1: Identidad y Verbos",
    "desc": "4 Ejercicios Prácticos. Debes completar todos correctamente para finalizar.",
    "icon": "fa-pencil-alt",
    "estimated_time": "30 min",
    "difficulty": "Básico"
}
</script>

<!-- 2. CONTENT (HTML) -->
<div id="exercise-content" class="space-y-12 text-gray-800 font-sans leading-relaxed pb-20">

    <!-- HEADER -->
    <div class="text-center border-b pb-6">
        <h1 class="text-3xl font-bold text-indigo-700">Práctica Intensiva</h1>
        <p class="text-gray-500 mt-2">Completa las 4 secciones. El sistema validará tus respuestas automáticamente.</p>
    </div>

    <!-- FLOATING KEYBOARD HELPER -->
    <div id="french-keyboard" class="sticky top-4 z-50 bg-white p-2 rounded-lg shadow-lg border border-indigo-100 flex justify-center gap-2 hidden transition-all duration-300 mx-auto max-w-md">
        <span class="text-xs font-bold text-gray-400 self-center mr-2 hidden sm:inline">Teclado:</span>
        <button type="button" onmousedown="insertChar('é', event)" class="w-8 h-8 bg-gray-100 hover:bg-indigo-100 rounded text-indigo-700 font-bold border shadow-sm">é</button>
        <button type="button" onmousedown="insertChar('è', event)" class="w-8 h-8 bg-gray-100 hover:bg-indigo-100 rounded text-indigo-700 font-bold border shadow-sm">è</button>
        <button type="button" onmousedown="insertChar('à', event)" class="w-8 h-8 bg-gray-100 hover:bg-indigo-100 rounded text-indigo-700 font-bold border shadow-sm">à</button>
        <button type="button" onmousedown="insertChar('ç', event)" class="w-8 h-8 bg-gray-100 hover:bg-indigo-100 rounded text-indigo-700 font-bold border shadow-sm">ç</button>
        <button type="button" onmousedown="insertChar('ê', event)" class="w-8 h-8 bg-gray-100 hover:bg-indigo-100 rounded text-indigo-700 font-bold border shadow-sm">ê</button>
        <button type="button" onmousedown="insertChar('\'', event)" class="w-8 h-8 bg-gray-100 hover:bg-indigo-100 rounded text-indigo-700 font-bold border shadow-sm">'</button>
    </div>

    <!-- EXERCISE 1: RULES & LOGIC (Selects) -->
    <section class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-indigo-600">
        <div class="flex items-center mb-4 justify-between">
            <h2 class="text-xl font-bold text-gray-800">1. Lógica y Reglas de Oro</h2>
            <span class="text-xs font-mono bg-indigo-100 text-indigo-800 py-1 px-2 rounded">Regla: No Artículos</span>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Q1 -->
            <div class="form-group">
                <label class="block font-semibold text-gray-700 mb-2">1. Selecciona la correcta:</label>
                <select class="w-full p-3 border rounded bg-gray-50 focus:ring-2 focus:ring-indigo-500 outline-none js-validate" data-type="select" data-answer="c">
                    <option value="">Elige...</option>
                    <option value="a">Je suis un comptable</option>
                    <option value="b">Je suis le comptable</option>
                    <option value="c">Je suis comptable</option>
                </select>
                <p class="msg hidden text-xs mt-1"></p>
            </div>

            <!-- Q2 -->
            <div class="form-group">
                <label class="block font-semibold text-gray-700 mb-2">2. Tienes 30 años. Dices:</label>
                <select class="w-full p-3 border rounded bg-gray-50 focus:ring-2 focus:ring-indigo-500 outline-none js-validate" data-type="select" data-answer="b">
                    <option value="">Elige...</option>
                    <option value="a">Je suis 30 ans</option>
                    <option value="b">J'ai 30 ans</option>
                    <option value="c">Je a 30 ans</option>
                </select>
                <p class="msg hidden text-xs mt-1"></p>
            </div>

            <!-- Q3 -->
            <div class="form-group">
                <label class="block font-semibold text-gray-700 mb-2">3. Femenino de "Directeur":</label>
                <select class="w-full p-3 border rounded bg-gray-50 focus:ring-2 focus:ring-indigo-500 outline-none js-validate" data-type="select" data-answer="a">
                    <option value="">Elige...</option>
                    <option value="a">La Directrice</option>
                    <option value="b">La Directeuse</option>
                    <option value="c">La Director</option>
                </select>
                <p class="msg hidden text-xs mt-1"></p>
            </div>

            <!-- Q4 -->
            <div class="form-group">
                <label class="block font-semibold text-gray-700 mb-2">4. ¿Cómo se dice "Pasante"?</label>
                <select class="w-full p-3 border rounded bg-gray-50 focus:ring-2 focus:ring-indigo-500 outline-none js-validate" data-type="select" data-answer="c">
                    <option value="">Elige...</option>
                    <option value="a">Le Stage</option>
                    <option value="b">L'étudiant</option>
                    <option value="c">Le Stagiaire</option>
                </select>
                <p class="msg hidden text-xs mt-1"></p>
            </div>

            <!-- Q5 -->
            <div class="form-group">
                <label class="block font-semibold text-gray-700 mb-2">5. "Être en retard" significa:</label>
                <select class="w-full p-3 border rounded bg-gray-50 focus:ring-2 focus:ring-indigo-500 outline-none js-validate" data-type="select" data-answer="b">
                    <option value="">Elige...</option>
                    <option value="a">Estar listo</option>
                    <option value="b">Llegar tarde / Estar retrasado</option>
                    <option value="c">Estar de acuerdo</option>
                </select>
                <p class="msg hidden text-xs mt-1"></p>
            </div>

            <!-- Q6 -->
            <div class="form-group">
                <label class="block font-semibold text-gray-700 mb-2">6. Para nacionalidad (Soy francesa) usas:</label>
                <select class="w-full p-3 border rounded bg-gray-50 focus:ring-2 focus:ring-indigo-500 outline-none js-validate" data-type="select" data-answer="a">
                    <option value="">Elige...</option>
                    <option value="a">Être (Je suis française)</option>
                    <option value="b">Avoir (J'ai française)</option>
                </select>
                <p class="msg hidden text-xs mt-1"></p>
            </div>
        </div>
    </section>

    <!-- EXERCISE 2: CONJUGATION (Fill In) -->
    <section class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-pink-500">
        <div class="flex items-center mb-4 justify-between">
            <h2 class="text-xl font-bold text-gray-800">2. Conjugación: Être vs Avoir</h2>
            <span class="text-xs font-mono bg-pink-100 text-pink-800 py-1 px-2 rounded">Escribe solo el verbo</span>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Q1 -->
            <div class="form-group">
                <label class="text-sm text-gray-600 block mb-1">1. (Yo soy) Je <span class="inline-block w-16 border-b border-gray-400"></span> consultant.</label>
                <input type="text" class="w-full p-2 border rounded bg-gray-50 focus:ring-2 focus:ring-pink-500 outline-none js-validate" 
                       data-type="text" data-answer="suis" placeholder="Escribe el verbo...">
                <p class="msg hidden text-xs mt-1"></p>
            </div>

            <!-- Q2 -->
            <div class="form-group">
                <label class="text-sm text-gray-600 block mb-1">2. (Nosotros tenemos) Nous <span class="inline-block w-16 border-b border-gray-400"></span> une réunion.</label>
                <input type="text" class="w-full p-2 border rounded bg-gray-50 focus:ring-2 focus:ring-pink-500 outline-none js-validate" 
                       data-type="text" data-answer="avons" placeholder="Escribe el verbo...">
                <p class="msg hidden text-xs mt-1"></p>
            </div>

            <!-- Q3 -->
            <div class="form-group">
                <label class="text-sm text-gray-600 block mb-1">3. (Tú tienes) Tu <span class="inline-block w-16 border-b border-gray-400"></span> 25 ans ?</label>
                <input type="text" class="w-full p-2 border rounded bg-gray-50 focus:ring-2 focus:ring-pink-500 outline-none js-validate" 
                       data-type="text" data-answer="as" placeholder="Escribe el verbo...">
                <p class="msg hidden text-xs mt-1"></p>
            </div>

            <!-- Q4 -->
            <div class="form-group">
                <label class="text-sm text-gray-600 block mb-1">4. (Usted es) Vous <span class="inline-block w-16 border-b border-gray-400"></span> le directeur ?</label>
                <input type="text" class="w-full p-2 border rounded bg-gray-50 focus:ring-2 focus:ring-pink-500 outline-none js-validate" 
                       data-type="text" data-answer="êtes" placeholder="Escribe el verbo...">
                <p class="msg hidden text-xs mt-1"></p>
            </div>

            <!-- Q5 -->
            <div class="form-group">
                <label class="text-sm text-gray-600 block mb-1">5. (Ellas están) Elles <span class="inline-block w-16 border-b border-gray-400"></span> ici.</label>
                <input type="text" class="w-full p-2 border rounded bg-gray-50 focus:ring-2 focus:ring-pink-500 outline-none js-validate" 
                       data-type="text" data-answer="sont" placeholder="Escribe el verbo...">
                <p class="msg hidden text-xs mt-1"></p>
            </div>

            <!-- Q6 -->
            <div class="form-group">
                <label class="text-sm text-gray-600 block mb-1">6. (Él tiene) Il <span class="inline-block w-16 border-b border-gray-400"></span> besoin de café.</label>
                <input type="text" class="w-full p-2 border rounded bg-gray-50 focus:ring-2 focus:ring-pink-500 outline-none js-validate" 
                       data-type="text" data-answer="a" placeholder="Escribe el verbo...">
                <p class="msg hidden text-xs mt-1"></p>
            </div>
        </div>
    </section>

    <!-- EXERCISE 3: SYNTAX / ORDERING (Replaces Reading) -->
    <section class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-yellow-500">
        <div class="flex items-center mb-4 justify-between">
            <h2 class="text-xl font-bold text-gray-800">3. Estructura de Frases</h2>
            <span class="text-xs font-mono bg-yellow-100 text-yellow-800 py-1 px-2 rounded">Ordena las palabras</span>
        </div>
        <p class="text-sm text-gray-500 mb-4">Escribe la frase completa en el orden correcto. Cuidado con la ortografía.</p>

        <div class="space-y-6">
            <!-- Q1 -->
            <div class="form-group">
                <p class="font-mono text-indigo-600 font-bold mb-2 bg-gray-100 p-2 rounded inline-block">suis / Je / comptable</p>
                <input type="text" class="w-full p-2 border-b-2 border-gray-300 focus:border-yellow-500 outline-none js-validate" 
                       data-type="text" data-answer="je suis comptable" placeholder="Escribe la frase ordenada aquí">
                <p class="msg hidden text-xs mt-1"></p>
            </div>

            <!-- Q2 -->
            <div class="form-group">
                <p class="font-mono text-indigo-600 font-bold mb-2 bg-gray-100 p-2 rounded inline-block">sommes / en / Nous / retard</p>
                <input type="text" class="w-full p-2 border-b-2 border-gray-300 focus:border-yellow-500 outline-none js-validate" 
                       data-type="text" data-answer="nous sommes en retard" placeholder="Escribe la frase ordenada aquí">
                <p class="msg hidden text-xs mt-1"></p>
            </div>

            <!-- Q3 -->
            <div class="form-group">
                <p class="font-mono text-indigo-600 font-bold mb-2 bg-gray-100 p-2 rounded inline-block">as / 20 / Tu / ans</p>
                <input type="text" class="w-full p-2 border-b-2 border-gray-300 focus:border-yellow-500 outline-none js-validate" 
                       data-type="text" data-answer="tu as 20 ans" placeholder="Escribe la frase ordenada aquí">
                <p class="msg hidden text-xs mt-1"></p>
            </div>

            <!-- Q4 -->
            <div class="form-group">
                <p class="font-mono text-indigo-600 font-bold mb-2 bg-gray-100 p-2 rounded inline-block">est / Elle / américaine</p>
                <input type="text" class="w-full p-2 border-b-2 border-gray-300 focus:border-yellow-500 outline-none js-validate" 
                       data-type="text" data-answer="elle est américaine" placeholder="Escribe la frase ordenada aquí">
                <p class="msg hidden text-xs mt-1"></p>
            </div>

            <!-- Q5 -->
            <div class="form-group">
                <p class="font-mono text-indigo-600 font-bold mb-2 bg-gray-100 p-2 rounded inline-block">bureau / Ils / au / sont</p>
                <input type="text" class="w-full p-2 border-b-2 border-gray-300 focus:border-yellow-500 outline-none js-validate" 
                       data-type="text" data-answer="ils sont au bureau" placeholder="Escribe la frase ordenada aquí">
                <p class="msg hidden text-xs mt-1"></p>
            </div>

            <!-- Q6 -->
            <div class="form-group">
                <p class="font-mono text-indigo-600 font-bold mb-2 bg-gray-100 p-2 rounded inline-block">réunion / J' / une / ai</p>
                <input type="text" class="w-full p-2 border-b-2 border-gray-300 focus:border-yellow-500 outline-none js-validate" 
                       data-type="text" data-answer="j'ai une réunion" placeholder="Escribe la frase ordenada aquí">
                <p class="msg hidden text-xs mt-1"></p>
            </div>
        </div>
    </section>

    <!-- EXERCISE 4: TRANSLATION (Strict) -->
    <section class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-green-600">
        <div class="flex items-center mb-4 justify-between">
            <h2 class="text-xl font-bold text-gray-800">4. Traducción Final</h2>
            <span class="text-xs font-mono bg-green-100 text-green-800 py-1 px-2 rounded">Usa los acentos</span>
        </div>
        
        <div class="space-y-4">
            <!-- Q1 -->
            <div class="form-group grid grid-cols-1 md:grid-cols-3 gap-2 items-center">
                <span class="font-semibold text-gray-700">1. Soy contadora.</span>
                <div class="col-span-2">
                    <input type="text" class="w-full p-2 border rounded focus:ring-2 focus:ring-green-500 outline-none js-validate" 
                           data-type="text" data-answer="je suis comptable">
                    <p class="msg hidden text-xs mt-1 text-right"></p>
                </div>
            </div>

            <!-- Q2 -->
            <div class="form-group grid grid-cols-1 md:grid-cols-3 gap-2 items-center">
                <span class="font-semibold text-gray-700">2. Tengo 25 años.</span>
                <div class="col-span-2">
                    <input type="text" class="w-full p-2 border rounded focus:ring-2 focus:ring-green-500 outline-none js-validate" 
                           data-type="text" data-answer="j'ai 25 ans">
                    <p class="msg hidden text-xs mt-1 text-right"></p>
                </div>
            </div>

            <!-- Q3 -->
            <div class="form-group grid grid-cols-1 md:grid-cols-3 gap-2 items-center">
                <span class="font-semibold text-gray-700">3. Ella es la directora.</span>
                <div class="col-span-2">
                    <input type="text" class="w-full p-2 border rounded focus:ring-2 focus:ring-green-500 outline-none js-validate" 
                           data-type="text" data-answer="elle est la directrice">
                    <p class="msg hidden text-xs mt-1 text-right"></p>
                </div>
            </div>

            <!-- Q4 -->
            <div class="form-group grid grid-cols-1 md:grid-cols-3 gap-2 items-center">
                <span class="font-semibold text-gray-700">4. Ustedes están de acuerdo.</span>
                <div class="col-span-2">
                    <input type="text" class="w-full p-2 border rounded focus:ring-2 focus:ring-green-500 outline-none js-validate" 
                           data-type="text" data-answer="vous êtes d'accord">
                    <p class="msg hidden text-xs mt-1 text-right"></p>
                </div>
            </div>

            <!-- Q5 -->
            <div class="form-group grid grid-cols-1 md:grid-cols-3 gap-2 items-center">
                <span class="font-semibold text-gray-700">5. Necesito (Tengo necesidad de).</span>
                <div class="col-span-2">
                    <input type="text" class="w-full p-2 border rounded focus:ring-2 focus:ring-green-500 outline-none js-validate" 
                           data-type="text" data-answer="j'ai besoin de">
                    <p class="msg hidden text-xs mt-1 text-right"></p>
                </div>
            </div>

            <!-- Q6 -->
            <div class="form-group grid grid-cols-1 md:grid-cols-3 gap-2 items-center">
                <span class="font-semibold text-gray-700">6. Él es el dueño.</span>
                <div class="col-span-2">
                    <input type="text" class="w-full p-2 border rounded focus:ring-2 focus:ring-green-500 outline-none js-validate" 
                           data-type="text" data-answer="il est le propriétaire">
                    <p class="msg hidden text-xs mt-1 text-right"></p>
                </div>
            </div>
        </div>
    </section>

    <!-- GLOBAL VALIDATION BAR -->
    <div class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-300 p-4 shadow-lg z-50 flex justify-between items-center">
        <div>
            <p id="status-text" class="text-sm font-bold text-gray-600">Progreso: <span id="completed-count">0</span>/24 completado</p>
        </div>
        <button id="finish-btn" onclick="finalCheck()" class="bg-gray-400 text-white font-bold py-2 px-6 rounded-lg cursor-not-allowed transition-colors" disabled>
            Comprobar Todo
        </button>
    </div>

</div>

<!-- 3. LOGIC SCRIPT -->
<script>
    // 1. KEYBOARD HELPER
    let activeInput = null;
    
    document.querySelectorAll('input[type="text"]').forEach(input => {
        input.addEventListener('focus', (e) => {
            activeInput = e.target;
            document.getElementById('french-keyboard').classList.remove('hidden');
        });
        // Validate immediately on blur (leaving the field)
        input.addEventListener('blur', (e) => {
            validateField(e.target);
            updateStatus();
        });
    });

    // Prevent button click from stealing focus completely, insert char, then refocus input
    function insertChar(char, event) {
        event.preventDefault(); // Prevent focus loss
        if (activeInput) {
            const start = activeInput.selectionStart;
            const end = activeInput.selectionEnd;
            const text = activeInput.value;
            
            activeInput.value = text.substring(0, start) + char + text.substring(end);
            activeInput.selectionStart = activeInput.selectionEnd = start + 1;
            activeInput.focus();
            
            // Trigger validation update visually
            activeInput.dispatchEvent(new Event('input'));
        }
    }

    // 2. VALIDATION LOGIC
    const inputs = document.querySelectorAll('.js-validate');

    function normalize(str) {
        if(!str) return "";
        return str.trim().toLowerCase().replace(/\s+/g, ' '); // Keep accents, just lowercase and trim
    }

    function validateField(field) {
        const userAnswer = normalize(field.value);
        const correctAnswer = normalize(field.dataset.answer);
        const msgEl = field.parentElement.querySelector('.msg');
        
        // Reset classes
        field.classList.remove('border-red-500', 'bg-red-50', 'border-green-500', 'bg-green-50');
        msgEl.classList.add('hidden');

        if (userAnswer === "") {
            return false; // Empty is not "wrong" yet, just incomplete
        }

        if (userAnswer === correctAnswer) {
            field.classList.add('border-green-500', 'bg-green-50');
            msgEl.textContent = "Correcto";
            msgEl.classList.remove('hidden', 'text-red-600');
            msgEl.classList.add('text-green-600', 'font-bold');
            return true;
        } else {
            field.classList.add('border-red-500', 'bg-red-50');
            msgEl.textContent = "Incorrecto. Inténtalo de nuevo.";
            msgEl.classList.remove('hidden', 'text-green-600');
            msgEl.classList.add('text-red-600');
            return false;
        }
    }

    // Handle Selects specifically
    document.querySelectorAll('select.js-validate').forEach(select => {
        select.addEventListener('change', (e) => {
            validateField(e.target);
            updateStatus();
        });
    });

    function updateStatus() {
        let correctCount = 0;
        let total = inputs.length;
        let allCorrect = true;

        inputs.forEach(input => {
            const userAnswer = normalize(input.value);
            const correctAnswer = normalize(input.dataset.answer);
            if (userAnswer === correctAnswer && userAnswer !== "") {
                correctCount++;
            } else {
                allCorrect = false;
            }
        });

        document.getElementById('completed-count').textContent = correctCount;
        
        const btn = document.getElementById('finish-btn');
        if (allCorrect) {
            btn.disabled = false;
            btn.classList.remove('bg-gray-400', 'cursor-not-allowed');
            btn.classList.add('bg-indigo-600', 'hover:bg-indigo-700', 'cursor-pointer');
            btn.textContent = "FINALIZAR LECCIÓN";
        } else {
            btn.disabled = true;
            btn.classList.add('bg-gray-400', 'cursor-not-allowed');
            btn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700', 'cursor-pointer');
            btn.textContent = `Faltan ${(total - correctCount)} respuestas`;
        }
    }

    function finalCheck() {
        // Double check everything
        let allValid = true;
        inputs.forEach(input => {
            if (!validateField(input)) allValid = false;
        });

        if (allValid) {
            alert("¡Felicidades! Has completado todos los ejercicios correctamente.");
            // Here you would normally trigger the 'Next Lesson' logic
        }
    }
</script>